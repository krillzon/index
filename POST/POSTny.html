<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Post to API</title>

  <style>
    div {
    border: 2px solid green;
    padding: 5px;
    margin: 5px;
  } 
  

</style>

</head>

<body>
  
  Ny post: <input type="text" id="name"/> <a href="#" onclick="createFunction(true)">Är på gymmet</a> <a href="#" onclick="createFunction(false)">Är inte på gymmet</a> 
  
  <div id="datadiv"></div>



  <script language="javascript">
    const uri = 'https://5cd15d84d4a78300147be92e.mockapi.io/isAtTheGym';

    loadData();


    // Tidigare kördes den här delen av koden direkt då vi laddade sidan.
    // Nu ligger den i en funktion, vilket gör att vi kan köra den när vi vill.
    // Efter varje funktion nedan (home, change och delete) så körs den här funktionen för att uppdatera listan
    function loadData() {
      const datadiv = document.getElementById('datadiv');
      datadiv.innerHTML = '';
      fetch(uri)
        .then((resp) => resp.json())
        .then(function (datas) {
          return datas.map(function (data) {
            let divtag = document.createElement('div');

            // Här har vi lagt till tre ytterligare länkar
            divtag.innerHTML = `${data.id} - ${data.name} - ${data.isAtTheGym==true?"På Gymmet":"Inte På Gymmet"} <a href="#" onclick="deleteFunction(${data.id})">Radera</a>`;
            datadiv.appendChild(divtag);
          })
        });
    }


    // Vi byter namn på den här funktionen, från 'homeFunction' till 'createFunction'
    // Det vi skriver i textrutan hamnar i variabeln 'textInput'
    function createFunction(isAtTheGymNow) {
      const textInput = document.getElementById('name').value;
      var data = { name: textInput, isAtTheGym: isAtTheGymNow }

      fetch(uri,
        {
          // Nytt!
          method: "POST", // *GET, POST, PUT, DELETE, etc.
          mode: "cors", // no-cors, cors, *same-origin
          cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
          credentials: "same-origin", // include, *same-origin, omit, 

          headers:
          {
            'Accept': 'application/json, text/plain, */*',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        }).then(res => res.json())
        .then(res => console.log(res))
        // Eftersom MockAPI har en liten fördröjning så låter vi sidan uppdateras först efter 
        // en halv sekund.
      setTimeout(() => {
        loadData();
      }, 1000);
    } 


    // Den här funktionen körs då man klickar på Radera.
    // Funktionen är nästan identisk med homeFunction, men har ett extra invärde 'id'
    // Istället för POST gör vi istället en DELETE.
    // vi lägger till id till den ursprungliga URIn.

    function deleteFunction(id) {

        // Den här raden behövs inte då vi raderar en post 
      //var data = { name: "Micke", isHome: isHomeNow }

      fetch(uri + "/" + id,
        {
          // Nytt!
          method: "DELETE", // *GET, POST, PUT, DELETE, etc.
          mode: "cors", // no-cors, cors, *same-origin
          cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
          credentials: "same-origin", // include, *same-origin, omit, 

          headers:
          {
            'Accept': 'application/json, text/plain, */*',
            'Content-Type': 'application/json'
          },
          // Ingen body:...
        }).then(res => res.json())
        .then(res => console.log(res))

    // Eftersom MockAPI har en liten fördröjning så låter vi sidan  
    // uppdateras först efter en halv sekund.
      setTimeout(() => {
        loadData();
      }, 500);

    }







  </script>
</body>
</html>


